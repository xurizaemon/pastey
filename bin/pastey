#!/usr/bin/env node

'use strict';

let program = require('commander'),
  fs = require('fs'),
  pastey = require('../lib/pastey.js');

let content = '';

let pasteyurl = process.env.PASTEYURL || 'http://localhost:5000/';

program
  // .command('pastey')
  .arguments('<filename>')
  // .arguments('pastey [filename]')
  .option('-h, --help', 'Show help')
  .option('-u, --url', 'URL of paste server')
  .action(function(filename) {
    console.log(content, 'filename');
    console.log(process.argv);
    let encrypted = pastey.encrypt(content, 'text/plain');
    pastey.submit(encrypted, pasteyurl)
      .then(function(result) {
        console.log(result.url);
      });
  });

if (process.stdin.isTTY) {
  console.log('isTTY');
  console.log(content);
  program.parse(process.argv);
}
else {
  console.log('not TTY');
  process.stdin.on('readable', function() {
      var chunk = this.read();
      if (chunk !== null) {
         content += chunk;
      }
  });
  process.stdin.on('end', function() {
    console.log(content);
    program.parse(process.argv);
  });
}
